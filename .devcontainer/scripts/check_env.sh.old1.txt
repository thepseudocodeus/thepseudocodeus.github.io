#!/usr/bin/env bash
set -e

echo "ğŸ” Checking devcontainer environment..."

# --- Micromamba ---
if ! command -v micromamba &>/dev/null; then
    echo "âŒ Micromamba is not installed!"
    exit 1
else
    echo "âœ… Micromamba found"
fi

# --- Python environment ---
if micromamba env list | grep -q 'dev'; then
    echo "âœ… 'dev' Python environment exists"
else
    echo "âš ï¸ 'dev' Python environment does not exist. Run setup.sh to create it."
fi

# --- Python ---
if command -v python &>/dev/null; then
    PY_VER=$(python --version)
    echo "âœ… Python found: $PY_VER"
else
    echo "âŒ Python is missing!"
fi

# --- Node.js ---
if command -v node &>/dev/null; then
    NODE_VER=$(node --version)
    echo "âœ… Node.js found: $NODE_VER"
else
    echo "âš ï¸ Node.js is missing!"
fi

# --- Git ---
if command -v git &>/dev/null; then
    GIT_VER=$(git --version)
    echo "âœ… Git found: $GIT_VER"
else
    echo "âŒ Git is missing!"
fi

# --- tmux ---
if command -v tmux &>/dev/null; then
    TMUX_VER=$(tmux -V)
    echo "âœ… tmux found: $TMUX_VER"
else
    echo "âš ï¸ tmux is missing!"
fi

# --- Databases ---
if command -v psql &>/dev/null; then
    PSQL_VER=$(psql --version)
    echo "âœ… PostgreSQL CLI found: $PSQL_VER"
else
    echo "âš ï¸ PostgreSQL CLI not found"
fi

if command -v sqlite3 &>/dev/null; then
    SQLITE_VER=$(sqlite3 --version)
    echo "âœ… SQLite3 found: $SQLITE_VER"
else
    echo "âš ï¸ SQLite3 not found"
fi

if command -v duckdb &>/dev/null; then
    DUCKDB_VER=$(duckdb --version)
    echo "âœ… DuckDB CLI found: $DUCKDB_VER"
else
    echo "âš ï¸ DuckDB CLI not found"
fi

# --- Python dev tools ---
for tool in streamlit jupyter uvicorn; do
    if command -v $tool &>/dev/null; then
        TOOL_VER=$($tool --version 2>&1 | head -n 1)
        echo "âœ… $tool found: $TOOL_VER"
    else
        echo "âš ï¸ $tool not installed"
    fi
done

echo "ğŸ”¹ Devcontainer environment check complete!"
